generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Subreddit {
  id            String    @id @default(uuid())
  name          String    @unique
  enabled       Boolean   @default(true)
  createdAt     DateTime  @default(now()) @map("created_at")
  lastFetchedAt DateTime? @map("last_fetched_at")
  posts         Post[]

  @@map("subreddits")
}

model Post {
  id          String    @id @default(uuid())
  redditId    String    @unique @map("reddit_id")
  subredditId String    @map("subreddit_id")
  title       String
  body        String?
  author      String
  url         String
  score       Int       @default(0)
  numComments Int       @default(0) @map("num_comments")
  createdUtc  DateTime  @map("created_utc")
  fetchedAt   DateTime  @default(now()) @map("fetched_at")
  isFlagged   Boolean   @default(false) @map("is_flagged")
  subreddit   Subreddit @relation(fields: [subredditId], references: [id], onDelete: Cascade)

  // Triage (automated by Gemini - quick first pass)
  isTriaged       Boolean   @default(false) @map("is_triaged")
  passedTriage    Boolean?  @map("passed_triage")
  triageScore     Int?      @map("triage_score")
  triageReason    String?   @map("triage_reason")
  triagedAt       DateTime? @map("triaged_at")

  // Evaluation (done by Glitch - deep analysis)
  isEvaluated       Boolean   @default(false) @map("is_evaluated")
  evaluatedAt       DateTime? @map("evaluated_at")
  marketSizeScore   Int?      @map("market_size_score")    // 1-10
  wtpScore          Int?      @map("wtp_score")            // 1-10 willingness to pay
  easeScore         Int?      @map("ease_score")           // 1-10 ease of implementation
  competitionScore  Int?      @map("competition_score")    // 1-10 (10 = low competition = good)
  totalScore        Int?      @map("total_score")          // sum of above (max 40)
  evaluationNotes   String?   @map("evaluation_notes")

  // Niche fields
  isNiche            Boolean   @default(false) @map("is_niche")
  parentPostId       String?   @map("parent_post_id")
  parentPost         Post?     @relation("NicheToParent", fields: [parentPostId], references: [id], onDelete: SetNull)
  niches             Post[]    @relation("NicheToParent")
  nicheSource        String?   @map("niche_source")
  nicheDescription   String?   @map("niche_description")
  revenueScore       Int?      @map("revenue_score")       // 1-10
  nicheDefensibility Int?      @map("niche_defensibility")  // 1-10

  // Market Classification
  segment          String?   // "consumer" | "smb" | "mid-market" | "enterprise"
  businessModel    String?   @map("business_model")  // "b2c" | "b2b" | "b2b2c" | "prosumer"
  industry         String?   // e.g. "saas", "ecommerce", "healthcare"
  vertical         String?   // free text, more specific than industry

  // Revenue Model
  revenueType      String?   @map("revenue_type")     // "saas" | "usage-based" | "one-time" | "freemium" | "marketplace" | "api-metered"
  pricingTier      String?   @map("pricing_tier")     // "free" | "under-20" | "20-50" | "50-100" | "100-500" | "500-plus"
  revenueCeiling   Int?      @map("revenue_ceiling")  // realistic monthly revenue cap in dollars

  // Build Complexity
  stack            String?   // "web-app" | "mobile" | "browser-extension" | "api-cli" | "desktop" | "shopify-app" | "wordpress-plugin"
  dataMoat         String?   @map("data_moat")    // "none" | "user-generated" | "proprietary-dataset" | "network-effects" | "integration-lock-in"
  maintenance      String?   // "low" | "medium" | "high"

  // Audience
  buyer            String?   // "individual" | "team-lead" | "business-owner" | "it-admin"
  userCountEstimate String?  @map("user_count_estimate")  // "hundreds" | "thousands" | "tens-of-thousands" | "hundreds-of-thousands"
  geography        String?   // "global" | "us-only" | "region-specific" | "language-specific"

  // Opportunity Quality
  signalSource     String?   @map("signal_source")  // "complaint" | "is-there-a-tool" | "workflow-gap" | "manual-process" | "pricing-frustration"
  urgency          String?   // "nice-to-have" | "pain-point" | "hair-on-fire"
  validation       String?   // "single-post" | "multiple-posts" | "comments-confirm" | "existing-spend"

  @@index([segment])
  @@index([industry])
  @@index([urgency])
  @@index([subredditId])
  @@index([createdUtc])
  @@index([isFlagged])
  @@index([isTriaged])
  @@index([passedTriage])
  @@index([isEvaluated])
  @@index([isNiche])
  @@index([parentPostId])
  @@map("posts")
}
