generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Subreddit {
  id            String    @id @default(uuid())
  name          String    @unique
  enabled       Boolean   @default(true)
  createdAt     DateTime  @default(now()) @map("created_at")
  lastFetchedAt DateTime? @map("last_fetched_at")
  posts         Post[]

  @@map("subreddits")
}

model Post {
  id          String    @id @default(uuid())
  redditId    String    @unique @map("reddit_id")
  subredditId String    @map("subreddit_id")
  title       String
  body        String?
  author      String
  url         String
  score       Int       @default(0)
  numComments Int       @default(0) @map("num_comments")
  createdUtc  DateTime  @map("created_utc")
  fetchedAt   DateTime  @default(now()) @map("fetched_at")
  isFlagged   Boolean   @default(false) @map("is_flagged")
  subreddit   Subreddit @relation(fields: [subredditId], references: [id], onDelete: Cascade)

  // Triage (automated by Gemini - quick first pass)
  isTriaged       Boolean   @default(false) @map("is_triaged")
  passedTriage    Boolean?  @map("passed_triage")
  triageScore     Int?      @map("triage_score")
  triageReason    String?   @map("triage_reason")
  triagedAt       DateTime? @map("triaged_at")

  // Evaluation (done by Glitch - deep analysis)
  isEvaluated       Boolean   @default(false) @map("is_evaluated")
  evaluatedAt       DateTime? @map("evaluated_at")
  marketSizeScore   Int?      @map("market_size_score")    // 1-10
  wtpScore          Int?      @map("wtp_score")            // 1-10 willingness to pay
  easeScore         Int?      @map("ease_score")           // 1-10 ease of implementation
  competitionScore  Int?      @map("competition_score")    // 1-10 (10 = low competition = good)
  totalScore        Int?      @map("total_score")          // sum of above (max 40)
  evaluationNotes   String?   @map("evaluation_notes")

  @@index([subredditId])
  @@index([createdUtc])
  @@index([isFlagged])
  @@index([isTriaged])
  @@index([passedTriage])
  @@index([isEvaluated])
  @@map("posts")
}
